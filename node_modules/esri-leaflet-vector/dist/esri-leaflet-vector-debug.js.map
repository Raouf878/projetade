{"version":3,"file":"esri-leaflet-vector-debug.js","sources":["../src/Util.js","../src/MaplibreGLLayer.js","../src/VectorTileLayer.js","../src/VectorBasemapLayer.js"],"sourcesContent":["import { latLng, latLngBounds } from 'leaflet';\r\nimport { request, Support, Util } from 'esri-leaflet';\r\n\r\n/*\r\n  utility to establish a URL for the basemap styles API\r\n  used primarily by VectorBasemapLayer.js\r\n*/\r\nexport function getBasemapStyleUrl (style, apikey) {\r\n  if (style.includes('/')) {\r\n    throw new Error(style + ' is a v2 style enumeration. Set version:2 to request this style');\r\n  }\r\n\r\n  let url =\r\n    'https://basemaps-api.arcgis.com/arcgis/rest/services/styles/' +\r\n    style +\r\n    '?type=style';\r\n  if (apikey) {\r\n    url = url + '&token=' + apikey;\r\n  }\r\n  return url;\r\n}\r\n\r\nexport function getBasemapStyleV2Url (style, apikey, language) {\r\n  if (style.includes(':')) {\r\n    throw new Error(style + ' is a v1 style enumeration. Set version:1 to request this style');\r\n  }\r\n\r\n  let url = 'https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/styles/';\r\n  if (!(style.startsWith('osm/') || style.startsWith('arcgis/')) && style.length === 32) {\r\n    // style is an itemID\r\n    url = url + 'items/' + style;\r\n\r\n    if (language) {\r\n      throw new Error('The \\'language\\' parameter is not supported for custom basemap styles');\r\n    }\r\n  } else {\r\n    url = url + style;\r\n  }\r\n\r\n  if (apikey) {\r\n    url = url + '?token=' + apikey;\r\n\r\n    if (language) {\r\n      url = url + '&language=' + language;\r\n    }\r\n  }\r\n  return url;\r\n}\r\n/*\r\n  utilities to communicate with custom user styles via an ITEM ID or SERVICE URL\r\n  used primarily by VectorTileLayer.js\r\n*/\r\nexport function loadStyle (idOrUrl, options, callback) {\r\n  const httpRegex = /^https?:\\/\\//;\r\n  const serviceRegex = /\\/VectorTileServer\\/?$/;\r\n\r\n  if (httpRegex.test(idOrUrl) && serviceRegex.test(idOrUrl)) {\r\n    const serviceUrl = idOrUrl;\r\n    loadStyleFromService(serviceUrl, options, callback);\r\n  } else {\r\n    const itemId = idOrUrl;\r\n    loadStyleFromItem(itemId, options, callback);\r\n  }\r\n}\r\n\r\nexport function loadService (serviceUrl, options, callback) {\r\n  const params = options.token ? { token: options.token } : {};\r\n  request(serviceUrl, params, callback);\r\n}\r\n\r\nfunction loadItem (itemId, options, callback) {\r\n  const params = options.token ? { token: options.token } : {};\r\n  const url = options.portalUrl + '/sharing/rest/content/items/' + itemId;\r\n  request(url, params, callback);\r\n}\r\n\r\nfunction loadStyleFromItem (itemId, options, callback) {\r\n  const itemStyleUrl =\r\n    options.portalUrl +\r\n    '/sharing/rest/content/items/' +\r\n    itemId +\r\n    '/resources/styles/root.json';\r\n\r\n  loadStyleFromUrl(itemStyleUrl, options, function (error, style) {\r\n    if (error) {\r\n      loadItem(itemId, options, function (error, item) {\r\n        if (error) {\r\n          callback(error);\r\n          return;\r\n        }\r\n        loadStyleFromService(item.url, options, callback);\r\n      });\r\n    } else {\r\n      loadItem(itemId, options, function (error, item) {\r\n        if (error) {\r\n          callback(error);\r\n          return;\r\n        }\r\n        loadService(item.url, options, function (error, service) {\r\n          callback(error, style, itemStyleUrl, service, item.url);\r\n        });\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\nfunction loadStyleFromService (serviceUrl, options, callback) {\r\n  loadService(serviceUrl, options, function (error, service) {\r\n    if (error) {\r\n      callback(error);\r\n      return;\r\n    }\r\n\r\n    let sanitizedServiceUrl = serviceUrl;\r\n    // a trailing \"/\" may create invalid paths\r\n    if (serviceUrl.charAt(serviceUrl.length - 1) === '/') {\r\n      sanitizedServiceUrl = serviceUrl.slice(0, serviceUrl.length - 1);\r\n    }\r\n\r\n    let defaultStylesUrl;\r\n    // inadvertently inserting more than 1 adjacent \"/\" may create invalid paths\r\n    if (service.defaultStyles.charAt(0) === '/') {\r\n      defaultStylesUrl =\r\n        sanitizedServiceUrl + service.defaultStyles + '/root.json';\r\n    } else {\r\n      defaultStylesUrl =\r\n        sanitizedServiceUrl + '/' + service.defaultStyles + '/root.json';\r\n    }\r\n\r\n    loadStyleFromUrl(defaultStylesUrl, options, function (error, style) {\r\n      if (error) {\r\n        callback(error);\r\n        return;\r\n      }\r\n      callback(null, style, defaultStylesUrl, service, serviceUrl);\r\n    });\r\n  });\r\n}\r\n\r\nfunction loadStyleFromUrl (styleUrl, options, callback) {\r\n  const params = options.token ? { token: options.token } : {};\r\n  request(styleUrl, params, callback);\r\n}\r\n\r\nexport function formatStyle (style, styleUrl, metadata, token) {\r\n  // transforms style object in place and also returns it\r\n\r\n  // modify each source in style.sources\r\n  const sourcesKeys = Object.keys(style.sources);\r\n  for (let sourceIndex = 0; sourceIndex < sourcesKeys.length; sourceIndex++) {\r\n    const source = style.sources[sourcesKeys[sourceIndex]];\r\n\r\n    // if a relative path is referenced, the default style can be found in a standard location\r\n    if (source.url.indexOf('http') === -1) {\r\n      source.url = styleUrl.replace('/resources/styles/root.json', '');\r\n    }\r\n\r\n    // a trailing \"/\" may create invalid paths\r\n    if (source.url.charAt(source.url.length - 1) === '/') {\r\n      source.url = source.url.slice(0, source.url.length - 1);\r\n    }\r\n\r\n    // add tiles property if missing\r\n    if (!source.tiles) {\r\n      // right now ArcGIS Pro published vector services have a slightly different signature\r\n      // the '/' is needed in the URL string concatenation below for source.tiles\r\n      if (metadata.tiles && metadata.tiles[0].charAt(0) !== '/') {\r\n        metadata.tiles[0] = '/' + metadata.tiles[0];\r\n      }\r\n\r\n      source.tiles = [source.url + metadata.tiles[0]];\r\n    }\r\n\r\n    // some VectorTileServer endpoints may default to returning f=html,\r\n    // specify f=json to account for that behavior\r\n    source.url += '?f=json';\r\n\r\n    // add the token to the source url and tiles properties as a query param\r\n    source.url += token ? '&token=' + token : '';\r\n    source.tiles[0] += token ? '?token=' + token : '';\r\n    // add minzoom and maxzoom to each source based on the service metadata\r\n    // prefer minLOD/maxLOD if it exists since that is the level that tiles are cooked too\r\n    // MapLibre will overzoom for LODs that are not cooked\r\n    source.minzoom = metadata.minLOD || metadata.tileInfo.lods[0].level;\r\n    source.maxzoom =\r\n      metadata.maxLOD ||\r\n      metadata.tileInfo.lods[metadata.tileInfo.lods.length - 1].level;\r\n  }\r\n\r\n  // add the attribution and copyrightText properties to the last source in style.sources based on the service metadata\r\n  const lastSource = style.sources[sourcesKeys[sourcesKeys.length - 1]];\r\n  lastSource.attribution = metadata.copyrightText || '';\r\n  lastSource.copyrightText = metadata.copyrightText || '';\r\n\r\n  // if any layer in style.layers has a layout.text-font property (it will be any array of strings) remove all items in the array after the first\r\n  for (let layerIndex = 0; layerIndex < style.layers.length; layerIndex++) {\r\n    const layer = style.layers[layerIndex];\r\n    if (\r\n      layer.layout &&\r\n      layer.layout['text-font'] &&\r\n      layer.layout['text-font'].length > 1\r\n    ) {\r\n      layer.layout['text-font'] = [layer.layout['text-font'][0]];\r\n    }\r\n  }\r\n\r\n  if (style.sprite && style.sprite.indexOf('http') === -1) {\r\n    // resolve absolute URL for style.sprite\r\n    style.sprite = styleUrl.replace(\r\n      'styles/root.json',\r\n      style.sprite.replace('../', '')\r\n    );\r\n\r\n    // add the token to the style.sprite property as a query param\r\n    style.sprite += token ? '?token=' + token : '';\r\n  }\r\n\r\n  if (style.glyphs && style.glyphs.indexOf('http') === -1) {\r\n    // resolve absolute URL for style.glyphs\r\n    style.glyphs = styleUrl.replace(\r\n      'styles/root.json',\r\n      style.glyphs.replace('../', '')\r\n    );\r\n\r\n    // add the token to the style.glyphs property as a query param\r\n    style.glyphs += token ? '?token=' + token : '';\r\n  }\r\n\r\n  return style;\r\n}\r\n\r\n/*\r\n  utility to assist with dynamic attribution data\r\n  used primarily by VectorBasemapLayer.js\r\n*/\r\nexport function getAttributionData (url, map) {\r\n  if (Support.cors) {\r\n    request(url, {}, function (error, attributions) {\r\n      if (error) {\r\n        return;\r\n      }\r\n      map._esriAttributions = map._esriAttributions || [];\r\n      for (let c = 0; c < attributions.contributors.length; c++) {\r\n        const contributor = attributions.contributors[c];\r\n\r\n        for (let i = 0; i < contributor.coverageAreas.length; i++) {\r\n          const coverageArea = contributor.coverageAreas[i];\r\n          const southWest = latLng(coverageArea.bbox[0], coverageArea.bbox[1]);\r\n          const northEast = latLng(coverageArea.bbox[2], coverageArea.bbox[3]);\r\n          map._esriAttributions.push({\r\n            attribution: contributor.attribution,\r\n            score: coverageArea.score,\r\n            bounds: latLngBounds(southWest, northEast),\r\n            minZoom: coverageArea.zoomMin,\r\n            maxZoom: coverageArea.zoomMax\r\n          });\r\n        }\r\n      }\r\n\r\n      map._esriAttributions.sort(function (a, b) {\r\n        return b.score - a.score;\r\n      });\r\n\r\n      // pass the same argument as the map's 'moveend' event\r\n      const obj = { target: map };\r\n      Util._updateMapAttribution(obj);\r\n    });\r\n  }\r\n}\r\n\r\n/*\r\n  utility to check if a service's tileInfo spatial reference is in Web Mercator\r\n  used primarily by VectorTileLayer.js\r\n*/\r\nconst WEB_MERCATOR_WKIDS = [3857, 102100, 102113];\r\n\r\nexport function isWebMercator (wkid) {\r\n  return WEB_MERCATOR_WKIDS.indexOf(wkid) >= 0;\r\n}\r\n","import {\r\n  DomEvent,\r\n  DomUtil,\r\n  extend,\r\n  latLngBounds,\r\n  Layer,\r\n  setOptions,\r\n  Util\r\n} from 'leaflet';\r\nimport maplibregl from 'maplibre-gl';\r\n\r\nexport var MaplibreGLJSLayer = Layer.extend({\r\n  options: {\r\n    updateInterval: 32,\r\n    // How much to extend the overlay view (relative to map size)\r\n    // e.g. 0.1 would be 10% of map view in each direction\r\n    padding: 0.1,\r\n    // whether or not to register the mouse and keyboard\r\n    // events on the mapbox overlay\r\n    interactive: false,\r\n    // set the tilepane as the default pane to draw gl tiles\r\n    pane: 'tilePane'\r\n  },\r\n\r\n  initialize: function (options) {\r\n    setOptions(this, options);\r\n\r\n    // setup throttling the update event when panning\r\n    this._throttledUpdate = Util.throttle(\r\n      this._update,\r\n      this.options.updateInterval,\r\n      this\r\n    );\r\n  },\r\n\r\n  onAdd: function (map) {\r\n    if (!this._container) {\r\n      this._initContainer();\r\n    }\r\n\r\n    const paneName = this.getPaneName();\r\n    map.getPane(paneName).appendChild(this._container);\r\n\r\n    this._initGL();\r\n\r\n    this._offset = this._map.containerPointToLayerPoint([0, 0]);\r\n\r\n    // work around https://github.com/mapbox/mapbox-gl-leaflet/issues/47\r\n    if (map.options.zoomAnimation) {\r\n      DomEvent.on(\r\n        map._proxy,\r\n        DomUtil.TRANSITION_END,\r\n        this._transitionEnd,\r\n        this\r\n      );\r\n    }\r\n  },\r\n\r\n  onRemove: function (map) {\r\n    if (this._map._proxy && this._map.options.zoomAnimation) {\r\n      DomEvent.off(\r\n        this._map._proxy,\r\n        DomUtil.TRANSITION_END,\r\n        this._transitionEnd,\r\n        this\r\n      );\r\n    }\r\n\r\n    const paneName = this.getPaneName();\r\n\r\n    map.getPane(paneName).removeChild(this._container);\r\n    this._container = null;\r\n\r\n    this._glMap.remove();\r\n    this._glMap = null;\r\n  },\r\n\r\n  getEvents: function () {\r\n    return {\r\n      move: this._throttledUpdate, // sensibly throttle updating while panning\r\n      zoomanim: this._animateZoom, // applys the zoom animation to the <canvas>\r\n      zoom: this._pinchZoom, // animate every zoom event for smoother pinch-zooming\r\n      zoomstart: this._zoomStart, // flag starting a zoom to disable panning\r\n      zoomend: this._zoomEnd,\r\n      resize: this._resize\r\n    };\r\n  },\r\n\r\n  getMaplibreMap: function () {\r\n    return this._glMap;\r\n  },\r\n\r\n  getCanvas: function () {\r\n    return this._glMap.getCanvas();\r\n  },\r\n\r\n  getSize: function () {\r\n    return this._map.getSize().multiplyBy(1 + this.options.padding * 2);\r\n  },\r\n\r\n  getOpacity: function () {\r\n    return this.options.opacity;\r\n  },\r\n\r\n  setOpacity: function (opacity) {\r\n    this.options.opacity = opacity;\r\n    this._container.style.opacity = opacity;\r\n  },\r\n\r\n  getBounds: function () {\r\n    const halfSize = this.getSize().multiplyBy(0.5);\r\n    const center = this._map.latLngToContainerPoint(this._map.getCenter());\r\n    return latLngBounds(\r\n      this._map.containerPointToLatLng(center.subtract(halfSize)),\r\n      this._map.containerPointToLatLng(center.add(halfSize))\r\n    );\r\n  },\r\n\r\n  getContainer: function () {\r\n    return this._container;\r\n  },\r\n\r\n  // returns the pane name set in options if it is a valid pane, defaults to tilePane\r\n  getPaneName: function () {\r\n    return this._map.getPane(this.options.pane)\r\n      ? this.options.pane\r\n      : 'tilePane';\r\n  },\r\n\r\n  _initContainer: function () {\r\n    if (this._container) {\r\n      return;\r\n    }\r\n\r\n    this._container = DomUtil.create('div', 'leaflet-gl-layer');\r\n\r\n    const size = this.getSize();\r\n    const offset = this._map.getSize().multiplyBy(this.options.padding);\r\n    this._container.style.width = size.x + 'px';\r\n    this._container.style.height = size.y + 'px';\r\n\r\n    const topLeft = this._map.containerPointToLayerPoint([0, 0]).subtract(offset);\r\n\r\n    DomUtil.setPosition(this._container, topLeft);\r\n  },\r\n\r\n  _initGL: function () {\r\n    if (this._glMap) {\r\n      return;\r\n    }\r\n\r\n    const center = this._map.getCenter();\r\n\r\n    const options = extend({}, this.options, {\r\n      container: this._container,\r\n      center: [center.lng, center.lat],\r\n      zoom: this._map.getZoom() - 1,\r\n      attributionControl: false\r\n    });\r\n\r\n    this._glMap = new maplibregl.Map(options);\r\n\r\n    // Fire event for Maplibre \"styledata\" event.\r\n    this._glMap.once(\r\n      'styledata',\r\n      function (res) {\r\n        this.fire('styleLoaded');\r\n      }.bind(this)\r\n    );\r\n\r\n    // allow GL base map to pan beyond min/max latitudes\r\n    this._glMap.transform.latRange = null;\r\n    this._glMap.transform.maxValidLatitude = Infinity;\r\n\r\n    this._transformGL(this._glMap);\r\n\r\n    if (this._glMap._canvas.canvas) {\r\n      // older versions of mapbox-gl surfaced the canvas differently\r\n      this._glMap._actualCanvas = this._glMap._canvas.canvas;\r\n    } else {\r\n      this._glMap._actualCanvas = this._glMap._canvas;\r\n    }\r\n\r\n    // treat child <canvas> element like L.ImageOverlay\r\n    const canvas = this._glMap._actualCanvas;\r\n    DomUtil.addClass(canvas, 'leaflet-image-layer');\r\n    DomUtil.addClass(canvas, 'leaflet-zoom-animated');\r\n    if (this.options.interactive) {\r\n      DomUtil.addClass(canvas, 'leaflet-interactive');\r\n    }\r\n    if (this.options.className) {\r\n      DomUtil.addClass(canvas, this.options.className);\r\n    }\r\n  },\r\n\r\n  _update: function (e) {\r\n    // update the offset so we can correct for it later when we zoom\r\n    this._offset = this._map.containerPointToLayerPoint([0, 0]);\r\n\r\n    if (this._zooming) {\r\n      return;\r\n    }\r\n\r\n    const size = this.getSize();\r\n    const container = this._container;\r\n    const gl = this._glMap;\r\n    const offset = this._map.getSize().multiplyBy(this.options.padding);\r\n    const topLeft = this._map.containerPointToLayerPoint([0, 0]).subtract(offset);\r\n\r\n    DomUtil.setPosition(container, topLeft);\r\n\r\n    this._transformGL(gl);\r\n\r\n    if (gl.transform.width !== size.x || gl.transform.height !== size.y) {\r\n      container.style.width = size.x + 'px';\r\n      container.style.height = size.y + 'px';\r\n      if (gl._resize !== null && gl._resize !== undefined) {\r\n        gl._resize();\r\n      } else {\r\n        gl.resize();\r\n      }\r\n    } else {\r\n      // older versions of mapbox-gl surfaced update publicly\r\n      if (gl._update !== null && gl._update !== undefined) {\r\n        gl._update();\r\n      } else {\r\n        gl.update();\r\n      }\r\n    }\r\n  },\r\n\r\n  _transformGL: function (gl) {\r\n    const center = this._map.getCenter();\r\n\r\n    // gl.setView([center.lat, center.lng], this._map.getZoom() - 1, 0);\r\n    // calling setView directly causes sync issues because it uses requestAnimFrame\r\n\r\n    const tr = gl.transform;\r\n    tr.center = maplibregl.LngLat.convert([center.lng, center.lat]);\r\n    tr.zoom = this._map.getZoom() - 1;\r\n  },\r\n\r\n  // update the map constantly during a pinch zoom\r\n  _pinchZoom: function (e) {\r\n    this._glMap.jumpTo({\r\n      zoom: this._map.getZoom() - 1,\r\n      center: this._map.getCenter()\r\n    });\r\n  },\r\n\r\n  // borrowed from L.ImageOverlay\r\n  // https://github.com/Leaflet/Leaflet/blob/master/src/layer/ImageOverlay.js#L139-L144\r\n  _animateZoom: function (e) {\r\n    const scale = this._map.getZoomScale(e.zoom);\r\n    const padding = this._map.getSize().multiplyBy(this.options.padding * scale);\r\n    const viewHalf = this.getSize()._divideBy(2);\r\n    // corrections for padding (scaled), adapted from\r\n    // https://github.com/Leaflet/Leaflet/blob/master/src/map/Map.js#L1490-L1508\r\n    const topLeft = this._map\r\n      .project(e.center, e.zoom)\r\n      ._subtract(viewHalf)\r\n      ._add(this._map._getMapPanePos().add(padding))\r\n      ._round();\r\n    const offset = this._map\r\n      .project(this._map.getBounds().getNorthWest(), e.zoom)\r\n      ._subtract(topLeft);\r\n\r\n    DomUtil.setTransform(\r\n      this._glMap._actualCanvas,\r\n      offset.subtract(this._offset),\r\n      scale\r\n    );\r\n  },\r\n\r\n  _zoomStart: function (e) {\r\n    this._zooming = true;\r\n  },\r\n\r\n  _zoomEnd: function () {\r\n    const scale = this._map.getZoomScale(this._map.getZoom());\r\n\r\n    DomUtil.setTransform(this._glMap._actualCanvas, null, scale);\r\n\r\n    this._zooming = false;\r\n\r\n    this._update();\r\n  },\r\n\r\n  _transitionEnd: function (e) {\r\n    Util.requestAnimFrame(function () {\r\n      const zoom = this._map.getZoom();\r\n      const center = this._map.getCenter();\r\n      const offset = this._map.latLngToContainerPoint(\r\n        this._map.getBounds().getNorthWest()\r\n      );\r\n\r\n      // reset the scale and offset\r\n      DomUtil.setTransform(this._glMap._actualCanvas, offset, 1);\r\n\r\n      // enable panning once the gl map is ready again\r\n      this._glMap.once(\r\n        'moveend',\r\n        Util.bind(function () {\r\n          this._zoomEnd();\r\n        }, this)\r\n      );\r\n\r\n      // update the map position\r\n      this._glMap.jumpTo({\r\n        center: center,\r\n        zoom: zoom - 1\r\n      });\r\n    }, this);\r\n  }\r\n});\r\n\r\nexport function maplibreGLJSLayer (options) {\r\n  return new MaplibreGLJSLayer(options);\r\n}\r\n","import { Layer, setOptions } from 'leaflet';\r\nimport { loadStyle, formatStyle, isWebMercator } from './Util';\r\nimport { maplibreGLJSLayer } from './MaplibreGLLayer';\r\n\r\nexport var VectorTileLayer = Layer.extend({\r\n  options: {\r\n    // if portalUrl is not provided, default to ArcGIS Online\r\n    portalUrl: 'https://www.arcgis.com'\r\n  },\r\n\r\n  /**\r\n   * Populates \"this.options\" to be used in the rest of the module and creates the layer instance.\r\n   *\r\n   * @param {string} key an ITEM ID or SERVICE URL\r\n   * @param {object} options optional\r\n   */\r\n  initialize: function (key, options) {\r\n    if (options) {\r\n      setOptions(this, options);\r\n    }\r\n\r\n    // support outdated casing apiKey of apikey\r\n    if (this.options.apiKey) {\r\n      this.options.apikey = this.options.apiKey;\r\n    }\r\n\r\n    // if apiKey is passed in, propagate to token\r\n    // if token is passed in, propagate to apiKey\r\n    if (this.options.apikey) {\r\n      this.options.token = this.options.apikey;\r\n    } else if (this.options.token) {\r\n      this.options.apikey = this.options.token;\r\n    }\r\n\r\n    // if no key passed in\r\n    if (!key) {\r\n      throw new Error(\r\n        'An ITEM ID or SERVICE URL is required for vectorTileLayer.'\r\n      );\r\n    }\r\n\r\n    // set key onto \"this.options\" for use elsewhere in the module.\r\n    if (key) {\r\n      this.options.key = key;\r\n    }\r\n\r\n    // this.options has been set, continue on to create the layer:\r\n    this._createLayer();\r\n  },\r\n\r\n  /**\r\n   * Creates the maplibreGLJSLayer given using \"this.options\"\r\n   */\r\n  _createLayer: function () {\r\n    loadStyle(\r\n      this.options.key,\r\n      this.options,\r\n      function (error, style, styleUrl, service) {\r\n        if (error) {\r\n          this.fire('load-error', {\r\n            value: error\r\n          });\r\n          return;\r\n        }\r\n\r\n        if (!isWebMercator(service.tileInfo.spatialReference.wkid)) {\r\n          console.warn(\r\n            'This layer is not guaranteed to display properly because its service does not use the Web Mercator projection. The \"tileInfo.spatialReference\" property is:',\r\n            service.tileInfo.spatialReference,\r\n            '\\nMore information is available at https://github.com/maplibre/maplibre-gl-js/issues/168 and https://github.com/Esri/esri-leaflet-vector/issues/94.'\r\n          );\r\n        }\r\n\r\n        // once style object is loaded it must be transformed to be compliant with maplibreGLJSLayer\r\n        style = formatStyle(style, styleUrl, service, this.options.token);\r\n\r\n        this._createMaplibreLayer(style);\r\n      }.bind(this)\r\n    );\r\n  },\r\n\r\n  _setupAttribution: function () {\r\n    // if a custom attribution was not provided in the options,\r\n    // then attempt to rely on the attribution of the last source in the style object\r\n    // and add it to the map's attribution control\r\n    // (otherwise it would have already been added by leaflet to the attribution control)\r\n    if (!this.getAttribution()) {\r\n      const sources = this._maplibreGL.getMaplibreMap().style.stylesheet.sources;\r\n      const sourcesKeys = Object.keys(sources);\r\n      this.options.attribution =\r\n      sources[sourcesKeys[sourcesKeys.length - 1]].attribution;\r\n      if (this._map && this._map.attributionControl) {\r\n        // NOTE: if attribution is an empty string (or otherwise falsy) at this point it would not appear in the attribution control\r\n        this._map.attributionControl.addAttribution(this.getAttribution());\r\n      }\r\n    }\r\n  },\r\n\r\n  _createMaplibreLayer: function (style) {\r\n    this._maplibreGL = maplibreGLJSLayer({\r\n      style: style,\r\n      pane: this.options.pane,\r\n      opacity: this.options.opacity\r\n    });\r\n\r\n    this._ready = true;\r\n    this.fire('ready', {}, true);\r\n\r\n    this._maplibreGL.on('styleLoaded', function () {\r\n      this._setupAttribution();\r\n      // additionally modify the style object with the user's optional style override function\r\n      if (this.options.style && typeof this.options.style === 'function') {\r\n        this._maplibreGL._glMap.setStyle(this.options.style(this._maplibreGL._glMap.getStyle()));\r\n      }\r\n    }.bind(this));\r\n  },\r\n\r\n  onAdd: function (map) {\r\n    this._map = map;\r\n\r\n    if (this._ready) {\r\n      this._asyncAdd();\r\n    } else {\r\n      this.once(\r\n        'ready',\r\n        function () {\r\n          this._asyncAdd();\r\n        },\r\n        this\r\n      );\r\n    }\r\n  },\r\n\r\n  onRemove: function (map) {\r\n    map.removeLayer(this._maplibreGL);\r\n  },\r\n\r\n  _asyncAdd: function () {\r\n    const map = this._map;\r\n    this._maplibreGL.addTo(map, this);\r\n  }\r\n});\r\n\r\nexport function vectorTileLayer (key, options) {\r\n  return new VectorTileLayer(key, options);\r\n}\r\n\r\nexport default vectorTileLayer;\r\n","import { Util } from 'esri-leaflet';\r\nimport { getBasemapStyleUrl, getAttributionData, getBasemapStyleV2Url } from './Util';\r\nimport { VectorTileLayer } from './VectorTileLayer';\r\n\r\nexport var VectorBasemapLayer = VectorTileLayer.extend({\r\n  /**\r\n   * Populates \"this.options\" to be used in the rest of the module.\r\n   *\r\n   * @param {string} key\r\n   * @param {object} options optional\r\n   */\r\n  initialize: function (key, options) {\r\n    // Default to the v1 service endpoint\r\n    if (!options.version) {\r\n      if (key.includes('/')) options.version = 2;\r\n      else options.version = 1;\r\n    }\r\n    if (!key) {\r\n      // Default style enum if none provided\r\n      key = options.version === 1 ? 'ArcGIS:Streets' : 'arcgis/streets';\r\n    }\r\n    // If no API Key or token is provided (support outdated casing apiKey of apikey)\r\n    if (!(options.apikey || options.apiKey || options.token)) {\r\n      throw new Error('An API Key or token is required for vectorBasemapLayer.');\r\n    }\r\n    // Validate language param\r\n    if (options.language) {\r\n      if (options.version !== 2) {\r\n        throw new Error('The language parameter is only supported by the basemap styles service v2. Provide a v2 style enumeration to use this option.');\r\n      }\r\n    }\r\n    // Determine layer order\r\n    if (!options.pane) {\r\n      if (key.includes(':Label') || key.includes('/label')) {\r\n        options.pane = 'esri-labels';\r\n      } else if (key.includes(':Detail') || key.includes('/detail')) {\r\n        options.pane = 'esri-detail';\r\n      } else {\r\n        // Create layer in the tilePane by default\r\n        options.pane = 'tilePane';\r\n      }\r\n    }\r\n\r\n    // Options has been configured, continue on to create the layer:\r\n    VectorTileLayer.prototype.initialize.call(this, key, options);\r\n  },\r\n\r\n  /**\r\n   * Creates the maplibreGLJSLayer using \"this.options\"\r\n   */\r\n  _createLayer: function () {\r\n    let styleUrl;\r\n    if (this.options.version && this.options.version === 2) {\r\n      styleUrl = getBasemapStyleV2Url(this.options.key, this.options.apikey, this.options.language);\r\n    } else {\r\n      styleUrl = getBasemapStyleUrl(this.options.key, this.options.apikey);\r\n    }\r\n    this._createMaplibreLayer(styleUrl);\r\n  },\r\n\r\n  _setupAttribution: function () {\r\n    // Set attribution\r\n    Util.setEsriAttribution(this._map);\r\n\r\n    if (this.options.key.length === 32) {\r\n      // this is an itemId\r\n      const sources = this._maplibreGL.getMaplibreMap().style.stylesheet.sources;\r\n      const allAttributions = [];\r\n      Object.keys(sources).forEach(function (key) {\r\n        allAttributions.push(sources[key].attribution);\r\n        if (sources[key].copyrightText && sources[key].copyrightText && sources[key].copyrightText !== '' && sources[key].attribution !== sources[key].copyrightText) {\r\n          allAttributions.push(sources[key].copyrightText);\r\n        }\r\n      });\r\n\r\n      this._map.attributionControl.addAttribution('<span class=\"\">' + allAttributions.join(', ') + '</span>');\r\n    } else {\r\n      // this is an enum\r\n      if (!this.options.attributionUrls) {\r\n        this.options.attributionUrls = this._getAttributionUrls(this.options.key);\r\n      }\r\n\r\n      if (this._map && this.options.attributionUrls) {\r\n        if (this._map.attributionControl) {\r\n          for (\r\n            let index = 0;\r\n            index < this.options.attributionUrls.length;\r\n            index++\r\n          ) {\r\n            const attributionUrl = this.options.attributionUrls[index];\r\n            getAttributionData(attributionUrl, this._map);\r\n          }\r\n\r\n          this._map.attributionControl.addAttribution(\r\n            '<span class=\"esri-dynamic-attribution\"></span>'\r\n          );\r\n        }\r\n        Util._updateMapAttribution({ target: this._map });\r\n      }\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Given a key, return the attribution url(s).\r\n   * @param {string} key\r\n   */\r\n  _getAttributionUrls: function (key) {\r\n    if (key.indexOf('OSM:') === 0 || (key.indexOf('osm/') === 0)) {\r\n      return ['https://static.arcgis.com/attribution/Vector/OpenStreetMap_v2'];\r\n    } else if (key.indexOf('ArcGIS:Imagery') === 0 || key.indexOf('arcgis/imagery') === 0) {\r\n      return [\r\n        'https://static.arcgis.com/attribution/World_Imagery',\r\n        'https://static.arcgis.com/attribution/Vector/World_Basemap_v2'\r\n      ];\r\n    }\r\n\r\n    // default:\r\n    return ['https://static.arcgis.com/attribution/Vector/World_Basemap_v2'];\r\n  },\r\n\r\n  _initPane: function () {\r\n    if (!this._map.getPane(this.options.pane)) {\r\n      const pane = this._map.createPane(this.options.pane);\r\n      pane.style.pointerEvents = 'none';\r\n\r\n      let zIndex = 500;\r\n      if (this.options.pane === 'esri-detail') {\r\n        zIndex = 250;\r\n      } else if (this.options.pane === 'esri-labels') {\r\n        zIndex = 300;\r\n      }\r\n      pane.style.zIndex = zIndex;\r\n    }\r\n  },\r\n\r\n  onRemove: function (map) {\r\n    map.off('moveend', Util._updateMapAttribution);\r\n    map.removeLayer(this._maplibreGL);\r\n\r\n    if (map.attributionControl) {\r\n      const element = document.getElementsByClassName('esri-dynamic-attribution');\r\n\r\n      if (element && element.length > 0) {\r\n        const vectorAttribution = element[0].outerHTML;\r\n        // this doesn't work, not sure why.\r\n        map.attributionControl.removeAttribution(vectorAttribution);\r\n      }\r\n    }\r\n  },\r\n\r\n  _asyncAdd: function () {\r\n    const map = this._map;\r\n    this._initPane();\r\n    map.on('moveend', Util._updateMapAttribution);\r\n    this._maplibreGL.addTo(map, this);\r\n  }\r\n});\r\n\r\nexport function vectorBasemapLayer (key, options) {\r\n  return new VectorBasemapLayer(key, options);\r\n}\r\n\r\nexport default vectorBasemapLayer;\r\n"],"names":["request","Support","latLng","latLngBounds","Util","Layer","setOptions","DomEvent","DomUtil","extend","maplibregl"],"mappings":"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"}